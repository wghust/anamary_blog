/*! anamary_blog 2015-07-05;author: wangbinbin;nickname:done;blog: newblog.tecclass.cn;company:kaixun*/
$(document).ready(function(){function a(a){var b=a;b.children("input").click(function(){var a=b.children("ul").data("state");"down"==a?(b.children("ul").show(),b.children("ul").data({state:"up"})):(b.children("ul").hide(),b.children("ul").data({state:"down"}))}),b.children("ul").children("li").click(function(){var a=$(this),c=b.children("ul");c.hide(),b.children("input").val(a.data("uid")),c.data({state:"down"})})}function b(a){var b=a,d="",e=!1;""==b.uid?(d="/admin/insertcat",e=c(b)):d="/admin/updatecat",e||$.ajax({type:"POST",data:b,dataType:"json",url:d,success:function(a){var b=a;0==b.state?alert("添加不成功"):window.location.reload()}})}function c(a){var b=!1;return""==a.catname?b=!0:""==a.parentuid?b=!0:""==a.description?b=!0:b}$(".edit_ifm").click(function(a){var b=$(this),c=b.data("edit");if(0==c)b.html("保存"),b.data({edit:"1"}),$(".blogname").addClass("inedit").removeAttr("disabled"),$(".description").addClass("inedit").removeAttr("disabled");else{var d={blogname:$(".blogname").val(),description:$(".description").val()};$.ajax({type:"POST",dataType:"json",url:"/admin/saveifm",data:d,success:function(a){0==a.state?b.html(a.msg):(b.html(a.msg),b.html("编辑"),b.data({edit:"0"}),$(".blogname").removeClass("inedit").attr({disabled:"disabled"}),$(".description").removeClass("inedit").attr({disabled:"disabled"}))}})}return!1});var d=function(a){var b={nownum:parseInt(a)};$.ajax({type:"POST",dataType:"json",data:b,url:"/admin/getotherart",success:function(a){var b=a,c="";for(i=0;i<b.length;i++){var d="<tr>",e=b[i],f="";for(0==e.state&&(f="发布"),1==e.state&&(f="草稿"),2==e.state&&(f="隐私"),d+="<td><a href='/page/"+e.urltitle+"' class='one_art_name'>"+e.title+"</a></td><td>"+f+"</td><td>"+e.view+"</td><td>"+e.cats+"</td>",d+="<td>",j=0;j<e.tags.length;j++)d+="<a href='/tags/"+e.tags[j]+"' class='one_art_tag'>"+e.tags[j]+"</a>";d+="<div class='clear'></div></td>",d+="<td>"+e.date+"</td><td><a href='/admin/editpage/"+e.urltitle+"' class='onebtn' data-edit='0'>编辑</a></td>",c+=d}$(".article_table tbody").html(c)}})},e=function(a,b,c){var d="<ul class='pagination_ul' data-count='"+a+"' data-nownum='"+c+"'>";if(1!=c&&(d+="<li><a href='#'>&laquo;</a></li>"),1!=a)for(i=1;i<=a;i++)d+="<li>",d+=i==c?"<a href='#' class='active'>"+i+"</a>":"<a href='#'>"+i+"</a>",d+="</li>";c!=a&&1!=a&&(d+="<li><a href='#'>&raquo;</a></li>"),d+="</ul><div class='clear'></div>",$(".pagination").html(d),f()},f=function(){$(".pagination_ul li a").click(function(a){var b=$(this),c=b.parent("li").parent(".pagination_ul"),f=c.data("count"),g=c.data("nownum"),h=b.text();return"«"==h?h=g-1:"»"==h&&(h=g+1),console.log(h),parseInt(h)!=parseInt(g)&&(e(f,g,h),d(h-1)),!1})};f(),clearadd=function(a){$(".onecat_name").val(""),$(".onecat_uid").val(""),$(".onecat_dec").val(""),$(".onecat_parentid").val(""),$(".cat_add").data({state:!0}),$(".catedit").data({state:!0})},textadd=function(a){var b=a.parent("td");$(".onecat_name").val(b.siblings("td").eq(0).children("span").text()),$(".onecat_uid").val(b.siblings("td").eq(1).text()),$(".onecat_parentid").val(b.siblings("td").eq(2).children("span").text()),$(".onecat_dec").val(b.siblings("td").eq(3).children("span").text())},beginadd=function(a){var b=a.data("op");"inset"==b?$(".catedit").data({state:!1}):(textadd(a),$(".cat_add").data({state:!1}),$(".catedit").data({state:!1}),a.data({state:!0}))},showadd=function(a,b,c){console.log("this is "+a.data("state"));var d=a.data("isadd");d?($(".cat_block").animate({"margin-left":"0"},500,function(){a.data({isadd:!1}).text(c)}),$(".addcatform").fadeOut(500),clearadd(a)):($(".cat_block").animate({"margin-left":"-400px"},500,function(){a.data({isadd:!0}).text(b)}),$(".addcatform").fadeIn(500),beginadd(a))},$(".cat_add").click(function(a){var b=$(this);return 1==b.data("state")&&showadd(b,"关闭","添加"),!1}),a($(".cat_down")),$(".catedit").click(function(a){var b=$(this);return 1==b.data("state")&&showadd(b,"关闭","编辑"),!1}),$(".one_cat_add").click(function(a){var c={catname:$(".onecat_name").val(),parentuid:$(".onecat_parentid").val(),uid:$(".onecat_uid").val(),description:$(".onecat_dec").val()};return b(c),!1}),$(".catdelete").click(function(){var a=$(this),b=a.parent("td").parent("tr"),c=a.parent("td").siblings("td").eq(1).text(),d={uid:c};$.ajax({type:"POST",dataType:"json",data:d,url:"/admin/catdelete",success:function(a){a.state?b.remove():alert("删除不成功")}})})});