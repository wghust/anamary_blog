/*! anamary_blog 2015-07-05;author: wangbinbin;nickname:done;blog: newblog.tecclass.cn;company:kaixun*/
$(document).ready(function(){addOne=function(){_athis=this,_athis.catId=$(".summary_add").data("catid")},addOne.prototype={_init:function(){_athis._op();var a=window.location.href,b=a.lastIndexOf("#");if(-1!=b){var c=$(".summary_link"),d=a.substring(b+1,a.length);console.log(d);for(var e=-1,f=0;f<c.length;f++)if(c.eq(f).attr("id")==d){c.eq(f).css({border:"1px solid red","border-radius":"5px"}),e=f;break}-1!=e&&setTimeout(function(){c.eq(e).css({"border-width":0,"border-radius":0})},5e3)}},_showSelectPanel:function(){$(".summary_selectaddTypePanel").show(),$(".summary_add").data({type:1}),$(".summary_add").text("取消")},_hideSelectPanel:function(){$(".summary_selectaddTypePanel").hide(),$(".summary_add").data({type:0}),$(".summary_add").text("添加"),_athis._initPanel()},_checkUrl:function(a){var b=/((http|ftp|https|file):\/\/([\w\-]+\.)+[\w\-]+(\/[\w\u4e00-\u9fa5\-\.\/?\@\%\!\&=\+\~\:\#\;\,]*)?)/gi;return b.test(a)?!0:!1},_checkIsOk:function(){var a=$.trim($(".summary_linkshow").val());return _athis._checkUrl(a)?!0:(alert("url错误"),!1)},_addWant:function(a,b){$.ajax({url:"/summary/one/want",data:{_id:b},dataType:"json",type:"POST",success:function(b){if(b.state){var c=parseInt(a.data("wantnum")),d=c+1;a.data({wantnum:d}),a.html("&nbsp;"+d+"想看")}else alert("想看失败")}})},_op:function(){$("body").on("click",".summary_want",function(a){var b=$(this).parent(".summary_link").data("sumid");return _athis._addWant($(this),b),!1}),$(".summary_add").click(function(a){var b=$(this).data("type");return 0==b?_athis._showSelectPanel():_athis._hideSelectPanel(),!1}),$(".addLinks").click(function(){_athis._checkIsOk()&&($(".addLinks").text("添加中"),$.ajax({url:"/summary/one/add",type:"POST",dataType:"json",data:{type:0,catid:_athis.catId,onelink:{url:$.trim($(".summary_linkshow").val()),desc:$.trim($(".summary_linkdesc").val())}},success:function(a){var b=a;if(b.state){var c=b.newLink,d={_id:c._id,url:c.surl,title:c.sname,desc:c.sdesc,date:c.sdate},e=$("#newLink").html();Mustache.parse(e);var f=Mustache.render(e,d);$(".summary_nav").after(f),$(".addLinks").text("添加成功"),setTimeout(function(){$(".addLinks").text("添加链接"),_athis._hideSelectPanel()},500)}else alert("添加失败")}}))})},_initPanel:function(){$(".summary_linkshow").val("http://"),$(".summary_linkdesc").val("")}};var a=new addOne;a._init()});