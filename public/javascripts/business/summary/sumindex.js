/*! anamary_blog 2015-07-05;author: wangbinbin;nickname:done;blog: newblog.tecclass.cn;company:kaixun*/
$(document).ready(function(){addCat=function(){_cthis=this},addCat.prototype={_init:function(){Waves.init(),Waves.attach(".waves-image"),Waves.attach(".pagebtn"),_cthis._op()},_op:function(){$(".sumcatbgin").click(function(){$(".sumcatbginfile").click()}),$(".sumcatbginfile").change(function(){var a=$(this)[0].files[0],b=a.name.substring(a.name.lastIndexOf("."),a.name.length);_cthis._checkIsFile(b)?_cthis._uploadImage(a,b):alert("请选择图片文件")}),$(".summary_cataddbtn").click(function(a){return $(this).hasClass("disable")||($(this).addClass("disable"),$(".addcatpanel").animate({right:0},"slow")),!1}),$(".sumcatsave").click(function(a){return _cthis._saveCat(),!1}),$(".sumcattypein option").click(function(){var a=$(this).data("id");$(".sumcattypein").data({id:a})}),$(".sumcatcancel").click(function(a){return $(".addcatpanel").animate({right:"-420px"},"slow",function(){_cthis._initCatPanel()}),!1}),$(".one_summary_image").click(function(a){var b=$(this).siblings(".one_summary_desc").children("a").attr("href");setTimeout(function(){window.open(b)},200)})},_checkIsFile:function(a){return".jpeg"!=a&&".jpg"!=a&&".png"!=a?!1:!0},_uploadImage:function(a,b){var c=new FileReader;c.readAsDataURL(a),c.onload=function(a){var c=(new Date).getTime()+"langting"+parseInt(20*Math.random())+b;$.ajax({type:"POST",dataType:"json",url:"/summary/catimage/add",data:{imageData:a.target.result,imageName:c},success:function(a){var b=a;1==b.state?($(".sumcatbginimg").attr({src:b.imgurl}),$(".sumcatbginimg").show()):alert("上传失败")}})}},_getCat:function(){var a={cattype:{typeid:$(".sumcattypein option:selected").data("id"),typename:$(".sumcattypein option:selected").val()},catname:$.trim($(".sumcatnamein").val()),catdesc:$.trim($(".sumcatdescin").val()),catbg:$(".sumcatbginimg").attr("src")};return a},_checkCat:function(a){var b=!0;return""==a.catname?(alert("请添加名称"),b=!1):""==a.catbg&&(alert("请上传图片"),b=!1),b},_initCatPanel:function(){$(".sumcatnamein").val(""),$(".sumcatdescin").val(""),$(".sumcatbginimg").attr({src:""}),$(".sumcatbginimg").hide(),$(".summary_cataddbtn").removeClass("disable")},_saveCat:function(){var a=_cthis._getCat();_cthis._checkCat(a)&&$.ajax({type:"POST",dataType:"json",data:{newcat:a},url:"/summary/cat/add",success:function(a){a.state?(alert("保存成功"),$(".addcatpanel").animate({right:"-420px"},"slow",function(){_cthis._initCatPanel(),window.location.reload()})):alert("保存失败，请稍后保存")}})}};var a=new addCat;a._init()});