/*! anamary_blog 2015-07-05;author: wangbinbin;nickname:done;blog: newblog.tecclass.cn;company:kaixun*/
$(document).ready(function(){var a=$(".tags_input");a.keypress(function(b){var c=b.which;if(13===c){var d=a.val(),e=[];e=d.split(/[;；]/),$.each(e,function(a,b){var c=b;if(""!=c){for(var d=$(".show_tags a").length,e=0,f=0;d>f;f++)c.toLowerCase()===$(".show_tags a").eq(f).text().toLowerCase()&&(e=1);0==e&&($(".show_tags").append("<a href='javascript:void(0)' class='nowtags'>"+c+"</a>"),$(".nowtags").click(function(a){return $(this).remove(),fasle}))}}),a.val("")}});var b=CodeMirror.fromTextArea(document.getElementById("write_text"),{mode:"markdown",lineWrapping:!0,theme:"default",extraKeys:{Enter:"newlineAndIndentContinueMarkdownList"}});if(b.on("keyup",function(){var a=b.getValue().length;$(".write_wordsnum").text(a)}),$(".preview_btn").click(function(){var a=$(this),c=a.data("state");0==c?($(".show_preview").animate({left:"0"},500),a.data("state",1),a.text("关闭预览"),$(".show_preview").html(marked(b.getValue()))):($(".show_preview").animate({left:"100%"},500),a.data("state",0),a.text("预览"),$(".show_preview").html(""))}),"edit"===$(".write_container").data("type"))for(var c=$(".write_cat_select ul li"),d=$(".write_cat_select").data("catlist"),e=d.split(","),f=0;f<e.length;f++)for(var g=e[f].split("_")[1].toLowerCase(),h=0;h<c.length;h++)c.eq(h).hasClass("select")||c.eq(h).html().toLowerCase()===g&&c.eq(h).addClass("select");$(".cat_select").click(function(){var a=$(".write_cat");"none"==a.css("display")?a.slideDown():a.slideUp()}),$(".write_cat_select ul li").click(function(){var a=$(this);a.hasClass("select")?a.removeClass("select"):a.addClass("select")}),$(".art_state").click(function(){var a=$(".write_state");"none"==a.css("display")?a.slideDown():a.slideUp()}),$(".write_state_select ul li").click(function(){var a=$(this);a.hasClass("select")?a.removeClass("select"):($(".write_state_select ul li").removeClass("select"),a.addClass("select"))}),$(".write_save").click(function(a){var c="";for(f=0;f<$(".show_tags a").length;f++)0==f?c=$(".show_tags a").eq(f).html():c+=","+$(".show_tags a").eq(f).html();var d="",e=0,g=$(".write_cat_select ul li");for(f=0;f<g.length;f++)g.eq(f).hasClass("select")&&(0==e?d=g.eq(f).data("bigcat")+"_"+g.eq(f).html():d+=","+g.eq(f).data("bigcat")+"_"+g.eq(f).html(),e++);var h=0;h=$(".write_state_select ul li.select").data("state");var i={title:$(".write_title_in").val(),content:b.getValue(),tags:c,cats:d,state:parseInt(h),type:$(".write_container").data("type"),urltitle:$(".write_container").data("urltitle")};return $.ajax({type:"POST",url:"/admin/article_save",data:i,dataType:"json",success:function(a){var b=a;b.state?($(".write_msg").html(b.msg),setTimeout(function(){window.location.href="../../"},2e3)):$(".write_msg").html(b.msg)}}),!1})});